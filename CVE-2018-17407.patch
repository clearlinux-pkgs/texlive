From 6ed0077520e2b0da1fd060c7f88db7b2e6068e4c Mon Sep 17 00:00:00 2001
From: Norbert Preining <preining@logic.at>
Date: Wed, 19 Sep 2018 04:02:06 +0000
Subject: [PATCH] writet1 protection against buffer overflow

git-svn-id: svn://tug.org/texlive/trunk/Build/source@48697 c570f23f-e606-0410-a88d-b1316a301751
---
 texk/dvipsk/ChangeLog               | 5 +++++
 texk/dvipsk/writet1.c               | 2 ++
 texk/web2c/pdftexdir/ChangeLog      | 5 +++++
 texk/web2c/pdftexdir/writet1.c      | 2 ++
 6 files changed, 20 insertions(+)

diff --git a/texk/dvipsk/writet1.c b/texk/dvipsk/writet1.c
index 0fcf26907..3b478b900 100644
--- a/texk/dvipsk/writet1.c
+++ b/texk/dvipsk/writet1.c
@@ -1449,7 +1449,9 @@ static void t1_check_unusual_charstring(void)
         *(strend(t1_buf_array) - 1) = ' ';
 
         t1_getline();
+        alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);
         strcat(t1_buf_array, t1_line_array);
+        alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);
         strcpy(t1_line_array, t1_buf_array);
         t1_line_ptr = eol(t1_line_array);
     }
diff --git a/texk/web2c/pdftexdir/writet1.c b/texk/web2c/pdftexdir/writet1.c
index d191b77ee..8cfc2616c 100644
--- a/texk/web2c/pdftexdir/writet1.c
+++ b/texk/web2c/pdftexdir/writet1.c
@@ -1598,7 +1598,9 @@ static void t1_check_unusual_charstring(void)
         *(strend(t1_buf_array) - 1) = ' ';
 
         t1_getline();
+        alloc_array(t1_buf, strlen(t1_line_array) + strlen(t1_buf_array) + 1, T1_BUF_SIZE);
         strcat(t1_buf_array, t1_line_array);
+        alloc_array(t1_line, strlen(t1_buf_array) + 1, T1_BUF_SIZE);
         strcpy(t1_line_array, t1_buf_array);
         t1_line_ptr = eol(t1_line_array);
     }
